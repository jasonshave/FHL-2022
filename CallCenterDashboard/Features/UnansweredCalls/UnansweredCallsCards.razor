@inherits FluxorComponent
@inject IState<UnansweredCallsState> unansweredCallState
@inject IDispatcher dispatcher;

<MudPaper Class="pa-4">
    <MudText Typo="Typo.h4">Incoming Calls</MudText>
    @if (unansweredCallState.Value.UnansweredCalls.Any())
    {
        <MudGrid Justify="Justify.SpaceEvenly">
            @foreach(var call in unansweredCallState.Value.UnansweredCalls)
            {
                <MudItem xs="3">
                    <MudCard>
                        <MudCardMedia Image="images/old_phone.jpg" Height="100"/>
                        <MudCardContent>
                            <MudText Typo="Typo.h5">Incoming call</MudText>
                            <MudText Typo="Typo.body2">From: @call.IncomingCall.From.RawId</MudText>
                            <MudText Typo="Typo.body2">To: @call.IncomingCall.To.RawId</MudText>
                        </MudCardContent>
                        <MudCardActions>
                            <MudGrid>
                                <MudItem xs="12">
                                    <MudFab OnClick="() => Answer(call)" Label="Answer" StartIcon="@Icons.Material.Filled.Phone" Size="Size.Small" Color="Color.Success" ButtonType="ButtonType.Button">Answer</MudFab>
                                    <MudFab StartIcon="@Icons.Material.Filled.CallEnd" Size="Size.Small" Color="Color.Error" ButtonType="ButtonType.Button">Reject</MudFab>
                                    <MudFab StartIcon="@Icons.Material.Filled.PhoneForwarded" Size="Size.Small" Color="Color.Info" ButtonType="ButtonType.Button">Redirect</MudFab>
                                </MudItem>
                            </MudGrid>
                        </MudCardActions>
                    </MudCard>
                </MudItem>
            }
        </MudGrid>
    }
    else
    {
        <MudText>No incoming calls...</MudText>
    }
</MudPaper>

@code {
    void Answer(UnansweredCall unansweredCall)
    {
        dispatcher.Dispatch(new CallingServerAnswerAction(unansweredCall));
    }

    void Reject(UnansweredCall unansweredCall)
    {
        dispatcher.Dispatch(new CallingServerRejectAction(unansweredCall));
    }
}
