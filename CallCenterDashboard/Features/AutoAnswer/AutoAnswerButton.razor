@using CallCenterDashboard.Interfaces
@using Azure.Communication
@using Azure.Communication.PhoneNumbers
@inherits FluxorComponent
@inject IState<AutoAnswerState> autoAnswerState
@inject IDispatcher dispatcher
@inject IApplicationSettingsService applicationSettingsService

<MudSwitch CheckedChanged="Changed" T="bool" @bind-Value="_enabled" Color="Color.Success" Label="Auto Answer"/>

@code {
    [Parameter] public PurchasedPhoneNumber PhoneNumber { get; set; }
    bool _enabled;

    void Changed()
    {
        _enabled = !_enabled;
        dispatcher.Dispatch(new AutoAnswerSetAction(_enabled, PhoneNumber));
    }

    protected override void OnInitialized()
    {
        _enabled = applicationSettingsService.GetSettings().AutoAnswer;

        if (!autoAnswerState.Value.Initialized)
        {
            dispatcher.Dispatch(new AutoAnswerInitializeAction());
        }
        
        SubscribeToAction<AutoAnswerSetAction>(e =>
        {
            _enabled = e.Enabled;
            StateHasChanged();
        });

        base.OnInitialized();
    }
}
