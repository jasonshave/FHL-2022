@using CallCenterDashboard.Models
@using Azure.Communication.CallingServer
@using Azure.Communication
@using CallCenterDashboard.Features.CallDetails
@using Microsoft.AspNetCore.Components.Rendering;

@inherits FluxorComponent
@inject IDispatcher dispatcher
@inject IState<CallDetailsState> callDetailState

@page "/Calls/{Id}"

<MudBreadcrumbs Items="_items"></MudBreadcrumbs>
@if (@callDetailState.Value.PreviousId != Id)
{
   <MudProgressCircular Color="Color.Default" Indeterminate="true" />
}
else
{
    <CallDetail CallProperties="@callDetailState.Value.CallConnectionProperties" />
    
    <ParticipantTable Participants="@callDetailState.Value.Participants" />
}


@code {
    [Parameter]
    public string Id { get; set; }

    protected override void OnInitialized()
    {
        if (callDetailState.Value.PreviousId != Id )
        {
            dispatcher.Dispatch(new CallDetailInitializeAction(Id));
        }
        _items.Add(new BreadcrumbItem($"{Id}", href: null, disabled: true));
        base.OnInitialized();
    }

    private List<BreadcrumbItem> _items = new List<BreadcrumbItem>
    {
        new BreadcrumbItem("Home", href: "/"),
        new BreadcrumbItem("Calls", href: null, disabled: true),
    }; 
}
